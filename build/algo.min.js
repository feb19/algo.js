/*!*
 * algo.js
 *
 * JavaScript Creative Coding Framework
 * http://algojs.com
 *
 * Copyright 2015 hisa hayashi, HYS INC.
 */
var ALGO=function(){"use strict";function t(r){O=this,v=t.ObjectUtil.extend(param,r),e()}function e(){r(),n(),o()}function r(){O.width=param.width,O.height=param.height}function n(){O.render=new t.Render(O),O.render.setFramerate(O.framerate)}function i(){O.canvas=document.getElementById(v.id),O.canvas.width=v.width,O.canvas.height=v.height,O.renderer=new t.WebGLRenderer(O)}function o(){window.onload=function(){i(),O.setup&&O.setup.call(O)},window.onmouseover=function(){O.mouseover&&O.mouseover.call(O)},window.onmouseout=function(){O.mouseout&&O.mouseout.call(O)},window.onmousedown=function(){O.mousedown&&O.mousedown.call(O)},window.onmouseup=function(){O.mouseup&&O.mouseup.call(O)},window.onmousemove=function(t){if(O.mousemove){var e=t.clientX,r=t.clientY;O.mousemove.call(O,e,r)}},window.onkeydown=function(){O.keydown&&O.keydown.call(O)},window.onkeyup=function(){O.keyup&&O.keyup.call(O)},window.onresize=function(){O.resize&&O.resize.call(O),O.renderer&&O.renderer.resize()},O.render.startRender()}function a(t,e){this[t]=e,O[t]=this[t],O=this}function s(t,e){this[t]=e,O[t]=null}function c(){}function u(){}function h(){}function l(){}function d(){}function p(){}function f(){}function y(){}function g(){}function m(){}function _(){}function x(t,e){O.canvas.width=t,O.canvas.height=e,O.width=t,O.height=e}function A(t){t.add(O)}function L(t){t.remove(O)}var O,v={id:"",width:window.innerWidth,height:window.innerHeight};return t.prototype={constructor:t,setup:c,frame:u,destroy:h,mouseover:l,mouseout:d,mousedown:p,mouseup:f,mousemove:y,keydown:g,keyup:m,resize:_,bind:a,unbind:s,size:x,add:A,remove:L,render:null,renderer:null},t}();ALGO.debug=1,ALGO.BLEND_NONE=0,ALGO.BLEND_ADD=1,ALGO.BLEND_MULTIPLY=2,ALGO.BLEND_SCREEN=3,ALGO.prototype.__defineGetter__("framerate",function(){return this.framerate_}),ALGO.prototype.__defineSetter__("framerate",function(t){this.render&&this.render.setFramerate(t),this.framerate_=t}),ALGO.prototype.__defineGetter__("circleResolution",function(){return this.circleResolution_}),ALGO.prototype.__defineSetter__("circleResolution",function(t){ALGO.circleResolution=t,this.circleResolution_=t}),ALGO.prototype.width=0,ALGO.prototype.height=0,ALGO.prototype.blendMode=ALGO.BLEND_NONE,ALGO.prototype.backgroundAuto=!0,ALGO.prototype.background=6710886,ALGO.prototype.backgroundAlpha=.5,ALGO.prototype.framerate=60,ALGO.prototype.circleResolution=32,ALGO.prototype.canvas=null,ALGO.prototype.displayObjects=[],ALGO.prototype.children=[],ALGO.Render=function(){"use strict";function t(){e(),r()}function e(){}function r(){}function n(t){u=t,h=1e3/u,ALGO.log("setFramerate = "+u)}function i(){return u}function o(){y=!0,h=1e3/u,p=Date.now(),l=p,s()}function a(){y=!1}function s(){if(y&&m(s),d=Date.now(),f=d-p,f>h){p=d-f%h,c.renderer&&c.renderer.update(),c.frame&&c.frame.call(c);{var t=d-l;Math.round(1e3/(t/++g)*100)/100}}}var c,u,h,l,d,p,f,y=!1,g=0,m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/u)};return ALGO.Render=function(e){c=e,t()},ALGO.Render.prototype={constructor:ALGO.Render,setFramerate:n,getFramerate:i,startRender:o,stopRender:a},ALGO.Render}(),ALGO.Matrix3=function(t){"use strict";function e(){return new Float32Array(16)}function r(t){return t=[1,0,0,0,1,0,0,0,1]}function n(t,e,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],h=t[7],l=t[8],d=e[0],p=e[1],f=e[2],y=e[3],g=e[4],m=e[5],_=e[6],x=e[7],A=e[8];return r[0]=n*d+i*y+o*_,r[1]=n*p+i*g+o*x,r[2]=n*f+i*m+o*A,r[3]=a*d+s*y+c*_,r[4]=a*p+s*g+c*x,r[5]=a*f+s*m+c*A,r[6]=u*d+h*y+l*_,r[7]=u*p+h*g+l*x,r[8]=u*f+h*m+l*A,r}function i(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4]*e[1],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function o(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6]+e[0],r[7]=t[7]+e[1],r[8]=t[8],r}function a(t,e,r){var n=Math.cos(e),i=Math.sin(e);return r[0]=n,r[1]=-i,r[2]=t[2],r[3]=i,r[4]=n,r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function s(t,e){return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e}function c(t,e){return e}return t.Matrix3=function(){},t.Matrix3.prototype={constructor:t.Matrix3,create:e,identity:r,multiply:n,scale:i,translate:o,rotate:a,transpose:s,inverse:c},t.Matrix3}(ALGO),ALGO.Matrix4=function(t){"use strict";function e(){return new Float32Array(16)}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n(t,e,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],u=t[6],h=t[7],l=t[8],d=t[9],p=t[10],f=t[11],y=t[12],g=t[13],m=t[14],_=t[15],x=e[0],A=e[1],L=e[2],O=e[3],v=e[4],G=e[5],w=e[6],R=e[7],S=e[8],b=e[9],M=e[10],P=e[11],E=e[12],T=e[13],U=e[14],C=e[15];return r[0]=x*n+A*s+L*l+O*y,r[1]=x*i+A*c+L*d+O*g,r[2]=x*o+A*u+L*p+O*m,r[3]=x*a+A*h+L*f+O*_,r[4]=v*n+G*s+w*l+R*y,r[5]=v*i+G*c+w*d+R*g,r[6]=v*o+G*u+w*p+R*m,r[7]=v*a+G*h+w*f+R*_,r[8]=S*n+b*s+M*l+P*y,r[9]=S*i+b*c+M*d+P*g,r[10]=S*o+b*u+M*p+P*m,r[11]=S*a+b*h+M*f+P*_,r[12]=E*n+T*s+U*l+C*y,r[13]=E*i+T*c+U*d+C*g,r[14]=E*o+T*u+U*p+C*m,r[15]=E*a+T*h+U*f+C*_,r}function i(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1]*e[0],r[2]=t[2]*e[0],r[3]=t[3]*e[0],r[4]=t[4]*e[1],r[5]=t[5]*e[1],r[6]=t[6]*e[1],r[7]=t[7]*e[1],r[8]=t[8]*e[2],r[9]=t[9]*e[2],r[10]=t[10]*e[2],r[11]=t[11]*e[2],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function o(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],r[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],r[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],r[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],r}function a(t,e,r,n){var i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(!i)return null;var o=r[0],a=r[1],s=r[2];1!=i&&(i=1/i,o*=i,a*=i,s*=i);var c=Math.sin(e),u=Math.cos(e),h=1-u,l=t[0],d=t[1],p=t[2],f=t[3],y=t[4],g=t[5],m=t[6],_=t[7],x=t[8],A=t[9],L=t[10],O=t[11],v=o*o*h+u,G=a*o*h+s*c,w=s*o*h-a*c,R=o*a*h-s*c,S=a*a*h+u,b=s*a*h+o*c,M=o*s*h+a*c,P=a*s*h-o*c,E=s*s*h+u;return e?t!=n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=l*v+y*G+x*w,n[1]=d*v+g*G+A*w,n[2]=p*v+m*G+L*w,n[3]=f*v+_*G+O*w,n[4]=l*R+y*S+x*b,n[5]=d*R+g*S+A*b,n[6]=p*R+m*S+L*b,n[7]=f*R+_*S+O*b,n[8]=l*M+y*P+x*E,n[9]=d*M+g*P+A*E,n[10]=p*M+m*P+L*E,n[11]=f*M+_*P+O*E,n}function s(t,e,n,i){var o=t[0],a=t[1],s=t[2],c=n[0],u=n[1],h=n[2],l=e[0],d=e[1],p=e[2];if(o==l&&a==d&&s==p)return r(i);var f,y,g,m,_,x,A,L,O,v;return A=o-e[0],L=a-e[1],O=s-e[2],v=1/Math.sqrt(A*A+L*L+O*O),A*=v,L*=v,O*=v,f=u*O-h*L,y=h*A-c*O,g=c*L-u*A,v=Math.sqrt(f*f+y*y+g*g),v?(v=1/v,f*=v,y*=v,g*=v):(f=0,y=0,g=0),m=L*g-O*y,_=O*f-A*g,x=A*y-L*f,v=Math.sqrt(m*m+_*_+x*x),v?(v=1/v,m*=v,_*=v,x*=v):(m=0,_=0,x=0),i[0]=f,i[1]=m,i[2]=A,i[3]=0,i[4]=y,i[5]=_,i[6]=L,i[7]=0,i[8]=g,i[9]=x,i[10]=O,i[11]=0,i[12]=-(f*o+y*a+g*s),i[13]=-(m*o+_*a+x*s),i[14]=-(A*o+L*a+O*s),i[15]=1,i}function c(t,e,r,n,i){var o=r*Math.tan(t*Math.PI/360),a=o*e,s=2*a,c=2*o,u=n-r;return i[0]=2*r/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*r/c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-(n+r)/u,i[11]=-1,i[12]=0,i[13]=0,i[14]=-(n*r*2)/u,i[15]=0,i}function u(t,e){return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e}function h(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],u=t[7],h=t[8],l=t[9],d=t[10],p=t[11],f=t[12],y=t[13],g=t[14],m=t[15],_=r*s-n*a,x=r*c-i*a,A=r*u-o*a,L=n*c-i*s,O=n*u-o*s,v=i*u-o*c,G=h*y-l*f,w=h*g-d*f,R=h*m-p*f,S=l*g-d*y,b=l*m-p*y,M=d*m-p*g,P=1/(_*M-x*b+A*S+L*R-O*w+v*G);return e[0]=(s*M-c*b+u*S)*P,e[1]=(-n*M+i*b-o*S)*P,e[2]=(y*v-g*O+m*L)*P,e[3]=(-l*v+d*O-p*L)*P,e[4]=(-a*M+c*R-u*w)*P,e[5]=(r*M-i*R+o*w)*P,e[6]=(-f*v+g*A-m*x)*P,e[7]=(h*v-d*A+p*x)*P,e[8]=(a*b-s*R+u*G)*P,e[9]=(-r*b+n*R-o*G)*P,e[10]=(f*O-y*A+m*_)*P,e[11]=(-h*O+l*A-p*_)*P,e[12]=(-a*S+s*w-c*G)*P,e[13]=(r*S-n*w+i*G)*P,e[14]=(-f*L+y*x-g*_)*P,e[15]=(h*L-l*x+d*_)*P,e}return t.Matrix4=function(){},t.Matrix4.prototype={constructor:t.Matrix4,create:e,identity:r,multiply:n,scale:i,translate:o,rotate:a,lookAt:s,perspective:c,transpose:u,inverse:h},t.Matrix4}(ALGO),ALGO.ShapeCtrl={createID:function(t,e){for(var r="abcdefghijklmnopqrstuvwxyz0123456789",n=e?e:12,i="",o=0;n>o;o++){var a=r.length,s=Math.floor(Math.random()*a);i+=r.charAt(s)}return t.indexOf(i)>-1&&arguments.callee(t,e),i}},ALGO.Shape=function(){"use strict";function t(){"path"!==this.type&&(this.geometry=[],this.vertexPosition=[],this.vertexColors=[],this.index=[]),this.m=new ALGO.Matrix3,this.matrix=this.m.identity(this.m.create()),this.matrixScale=this.m.identity(this.m.create()),this.matrixRotate=this.m.identity(this.m.create()),this.matrixTranslate=this.m.identity(this.m.create())}function e(){this.setGeometry(),this.setVertexPosition(),this.setVertexColor(this.color),this.setVertexAlpha(this.alpha),this.setIndex(),this.setScale(this.scale),this.setRotate(this.rotate),this.setTranslate(this.x,this.y)}function r(t){this.id||(this.id=ALGO.ShapeCtrl.createID(t.displayObjects,8)),t.displayObjects.push(this.id),t.children.push(this)}function n(t){var e=t.displayObjects.indexOf(id);e>-1&&(t.displayObjects.splice(e,1),t.children.splice(e,1))}function i(){}function o(){var t=this.geometry;t[0]={x:0,y:-1},t[1]={x:-.87,y:.5},t[2]={x:.87,y:.5}}function a(){for(var t=this.vertexPosition,e=this.geometry.length,r=0;e>r;r++){var n=2*r;t[n]=this.geometry[r].x,t[n+1]=this.geometry[r].y}}function s(t){for(var e=this.vertexColors,r=this.geometry.length,n=ALGO.ColorUtil.hexToRgbNormalize(t),i=0;r>i;i++){var o=4*i;e[o]=n.r,e[o+1]=n.g,e[o+2]=n.b}}function c(t){for(var e=this.vertexColors,r=this.geometry.length,n=0;r>n;n++){var i=4*n;e[i+3]=t}}function u(){var t=[0,1,2];this.index=t}function h(t){if(this.m){var e=this.radius*t,r=this.radius*t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}}function l(t){if(this.m){var e=t*Math.PI/180;this.m.rotate(this.matrix,e,this.matrixRotate)}}function d(t,e){this.m&&this.m.translate(this.matrix,[t,e,0],this.matrixTranslate)}function p(){var t=null;return this.m&&(t=this.m.identity(this.m.create()),this.m.multiply(t,this.matrixScale,t),this.m.multiply(t,this.matrixRotate,t),this.m.multiply(t,this.matrixTranslate,t)),t}return ALGO.Shape=function(t,e,r){this.x=t,this.y=e,this.angles=3,this.radius=r,this.angles_=3,this.radius_=r,this.init(),this.setup()},ALGO.Shape.prototype={constructor:ALGO.Shape,name:"",type:"shape",id:null,x:0,y:0,angles:void 0,radius:null,alpha:1,visible:!0,color:16777215,scale:1,rotate:0,line:!1,lineColor:16777215,lineWidth:1,fill:!1,fillColor:16777215,m:void 0,matrix:void 0,matrixScale:void 0,matrixRotate:void 0,matrixTranslate:void 0,parent:void 0,children:[],geometry:[],vertexPosition:[],vertexColors:[],needsUpdate:!1,geometry:[],index:[],x_:0,y_:0,scale_:1,rotate_:0,radius_:null,color_:16777215,alpha_:1,angle_:void 0,needsUpdate_:!1,init:t,setup:e,add:r,remove:n,clone:i,setGeometry:o,setVertexPosition:a,setVertexColor:s,setVertexAlpha:c,setIndex:u,setScale:h,setRotate:l,setTranslate:d,getMatrix:p},ALGO.Shape}(),ALGO.Shape.prototype.__defineGetter__("x",function(){return this.x_}),ALGO.Shape.prototype.__defineSetter__("x",function(t){this.x_=t,this.setTranslate(this.x,this.y)}),ALGO.Shape.prototype.__defineGetter__("y",function(){return this.y_}),ALGO.Shape.prototype.__defineSetter__("y",function(t){this.y_=t,this.setTranslate(this.x,this.y)}),ALGO.Shape.prototype.__defineGetter__("scale",function(){return this.scale_}),ALGO.Shape.prototype.__defineSetter__("scale",function(t){this.setScale(t),this.scale_=t}),ALGO.Shape.prototype.__defineGetter__("rotate",function(){return this.rotate_}),ALGO.Shape.prototype.__defineSetter__("rotate",function(t){this.setRotate(t),this.rotate_=t}),ALGO.Shape.prototype.__defineGetter__("radius",function(){return this.radius_}),ALGO.Shape.prototype.__defineSetter__("radius",function(t){this.setScale(this.scale),this.radius_=t}),ALGO.Shape.prototype.__defineGetter__("color",function(){return this.color_}),ALGO.Shape.prototype.__defineSetter__("color",function(t){this.setVertexColor(t),this.color_=t}),ALGO.Shape.prototype.__defineGetter__("alpha",function(){return this.alpha_}),ALGO.Shape.prototype.__defineSetter__("alpha",function(t){this.setVertexAlpha(t),this.alpha_=t}),ALGO.Shape.prototype.__defineGetter__("angle",function(){return this.angle_}),ALGO.Shape.prototype.__defineSetter__("angle",function(t){this.angle_=t}),ALGO.Shape.prototype.__defineGetter__("needsUpdate",function(){return this.needsUpdate_}),ALGO.Shape.prototype.__defineSetter__("needsUpdate",function(t){this.needsUpdate_=t}),ALGO.Polygon=function(t,e,r,n){"use strict";this.x=t,this.y=e,this.angles=r,this.radius=n,this.angles_=r,this.radius_=n,this.type="polygon",this.init(),this.setup()},ALGO.Polygon.prototype=Object.create(ALGO.Shape.prototype),ALGO.Polygon.prototype.constructor=ALGO.Polygon,ALGO.Polygon.prototype.setGeometry=function(){for(var t=this.geometry=[],e=0;e<this.angles;e++)t[e]={},t[e].x=Math.cos(2*e*Math.PI/this.angles-Math.PI/2),t[e].y=Math.sin(2*e*Math.PI/this.angles-Math.PI/2)},ALGO.Polygon.prototype.setIndex=function(){var t=this.index=[];for(i=1;i<this.angles-1;i++)t.push(0),t.push(i),t.push(i+1)},ALGO.Circle=function(t,e,r){"use strict";this.x=t,this.y=e,this.angles=ALGO.circleResolution,this.radius=r,this.angles_=ALGO.circleResolution,this.radius_=r,this.type="circle",this.init(),this.setup()},ALGO.Circle.prototype=Object.create(ALGO.Polygon.prototype),ALGO.Circle.prototype.constructor=ALGO.Circle,ALGO.Rectangle=function(t,e,r,n){"use strict";this.x=t,this.y=e,this.width=r,this.height=n,this.width_=r,this.height_=n,this.type="rectangle",this.init(),this.setup()},ALGO.Rectangle.prototype=Object.create(ALGO.Shape.prototype),ALGO.Rectangle.prototype.constructor=ALGO.Rectangle,ALGO.Rectangle.prototype.width=0,ALGO.Rectangle.prototype.height=0,ALGO.Rectangle.prototype.width_=0,ALGO.Rectangle.prototype.height_=0,ALGO.Rectangle.prototype.setGeometry=function(){var t=this.geometry=[];t[0]=[],t[0].x=-.5,t[0].y=-.5,t[1]=[],t[1].x=.5,t[1].y=-.5,t[2]=[],t[2].x=.5,t[2].y=.5,t[3]=[],t[3].x=-.5,t[3].y=.5},ALGO.Rectangle.prototype.setScale=function(t){if(this.m){var e=this.width*t,r=this.height*t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}},ALGO.Rectangle.prototype.setIndex=function(){var t=[0,1,2,0,2,3];this.index=t},ALGO.Rectangle.prototype.__defineGetter__("width",function(){return this.width_}),ALGO.Rectangle.prototype.__defineSetter__("width",function(t){this.width_=t,this.setScale(this.scale)}),ALGO.Rectangle.prototype.__defineGetter__("height",function(){return this.height_}),ALGO.Rectangle.prototype.__defineSetter__("height",function(t){this.height_=t,this.setScale(this.scale)}),ALGO.Path=function(t,e){"use strict";this.moveTo(t.x,t.y),this.lineTo(e.x,e.y),ALGO.log(this.geometry),this.type="path",this.init(),this.setup()},ALGO.Path.prototype=Object.create(ALGO.Shape.prototype),ALGO.Path.prototype.constructor=ALGO.Path,ALGO.Path.prototype.closed=!1,ALGO.Path.prototype.setGeometry=function(){},ALGO.Path.prototype.setScale=function(t){if(this.m){var e=t,r=t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}},ALGO.Path.prototype.moveTo=function(t,e){var r={x:t,y:e};this.geometry.push(r),this.setVertexPosition(),this.setVertexColor(this.color),this.setVertexAlpha(this.alpha)},ALGO.Path.prototype.lineTo=function(t,e){var r={x:t,y:e};this.geometry.push(r),this.setVertexPosition(),this.setVertexColor(this.color),this.setVertexAlpha(this.alpha)},ALGO.Path.prototype.close=function(){this.closed=!0},ALGO.WebGLRenderer=function(t){"use strict";function e(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]}function r(){for(var r=new t.Matrix3,n=e(A,L),i=0;i<b.length;i++){{var o=b[i],a=o.needsUpdate;o.fill,o.line}if(!P[i]||a){var s=o.vertexPosition,c=o.vertexColors,u=[];u.position=d(s),u.color=d(c),P[i]=u}if(f(P[i],_,x),"path"!==o.type&&"particle"!==o.type){if(!T[i]||a){var h=o.index,l=p(h);U[i]=h,T[i]=l}g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,T[i])}var y=o.getMatrix(),m=r.multiply(y,n,[]);if(g.uniformMatrix3fv(O.matrix,!1,m),a&&(o.needsUpdate=!1),"path"==o.type)g.lineWidth(o.lineWidth),o.closed?g.drawArrays(g.LINE_LOOP,0,s.length/2):g.drawArrays(g.LINE_STRIP,0,s.length/2);else if("particle"==o.type)g.drawArrays(g.LINES,0,s.length/2);else{g.drawElements(g.TRIANGLES,U[i].length,g.UNSIGNED_SHORT,0);for(var v={r:0,g:0,b:0,alpha:1},G=[],w=0;w<s.length;w++){var R=2*w;G[R]=v.r,G[R+1]=v.g,G[R+2]=v.b,G[R+3]=v.alpha}var u=[];u.position=d(s),u.color=d(G),E[i]=u,f(E[i],_,x),g.lineWidth(5),g.drawArrays(g.LINE_LOOP,0,s.length/2)}}g.flush()}function n(){A=v.width,L=v.height;var t=g.getUniformLocation(m,"u_resolution");g.uniform2f(t,v.width,v.height),g.viewport(0,0,A,L)}function i(){o(y),a(),R&&(s(),c()),u()}function o(t){v=t.canvas,G=t.background,w=t.backgroundAlpha,R=t.backgroundAuto,S=t.depth,b=t.children,M=t.displayObjects}function a(){g.clearDepth(S)}function s(){var e=t.ColorUtil.hexToRgbNormalize(G);g.clearColor(e.r,e.g,e.b,w)}function c(){g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)}function u(){r()}function h(t){var e,r="";return"vertex"==t?(r="\r\n      attribute vec2 position2d;\r\n      uniform mat3 matrix2d;\r\n      uniform vec2 u_resolution;\r\n      attribute vec4 color;\r\n      varying   vec4 v_color; \r\n      uniform float point_size;\r\n      \r\n      void main(void){\r\n        v_color = color;\r\n        gl_PointSize = point_size;\r\n        \r\n        gl_Position = vec4((matrix2d * vec3(position2d, 1)).xy, 0, 1);\r\n      }",e=g.createShader(g.VERTEX_SHADER)):"fragment"==t&&(r="\r\n      precision mediump float;\r\n      varying vec4 v_color;\r\n      \r\n      void main(void){\r\n        gl_FragColor = v_color;\r\n      }",e=g.createShader(g.FRAGMENT_SHADER)),g.shaderSource(e,r),g.compileShader(e),g.getShaderParameter(e,g.COMPILE_STATUS)?e:void alert(g.getShaderInfoLog(e))}function l(t,e){var r=g.createProgram();return g.attachShader(r,t),g.attachShader(r,e),g.linkProgram(r),g.getProgramParameter(r,g.LINK_STATUS)?(g.useProgram(r),r):void alert(g.getProgramInfoLog(r))}function d(t){var e=g.createBuffer();return g.bindBuffer(g.ARRAY_BUFFER,e),g.bufferData(g.ARRAY_BUFFER,new Float32Array(t),g.STATIC_DRAW),g.bindBuffer(g.ARRAY_BUFFER,null),e}function p(t){var e=g.createBuffer();return g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,e),g.bufferData(g.ELEMENT_ARRAY_BUFFER,new Int16Array(t),g.STATIC_DRAW),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null),e}function f(t,e,r){for(var n in t)g.bindBuffer(g.ARRAY_BUFFER,t[n]),g.enableVertexAttribArray(e[n]),g.vertexAttribPointer(e[n],r[n],g.FLOAT,!1,0,0)}var y,g,m,_,x,A,L,O,v,G,w,R,S,b,M,P=[],E=[],T=[],U=[];return t.WebGLRenderer=function(t){y=t,o(y),g=v.getContext("webgl")||v.getContext("experimental-webgl");var e=h("vertex"),i=h("fragment");m=l(e,i),n(),O={},O.position=g.getUniformLocation(m,"position2d"),O.matrix=g.getUniformLocation(m,"matrix2d"),O.color=g.getUniformLocation(m,"color"),O.point_size=g.getUniformLocation(m,"point_size"),_={},_.position=g.getAttribLocation(m,"position2d"),_.color=g.getAttribLocation(m,"color"),x={},x.position=2,x.color=4,r()},t.WebGLRenderer.prototype={constructor:t.WebGLRenderer,update:i,resize:n},t.WebGLRenderer}(ALGO),ALGO.log=function(t){window.console&&window.console.log&&ALGO.debug&&window.console.log(t)},ALGO.warn=function(t){window.console&&window.console.warn&&ALGO.debug&&window.console.warn(t)},ALGO.error=function(t){window.console&&window.console.error&&ALGO.debug&&window.console.error(t)},ALGO.PointUtil={normalize:function(t,e){var r=Math.sqrt(t.x*t.x+t.y*t.y);0!=r&&(t.x=e*t.x/r,t.y=e*t.y/r)},normalize3:function(t,e){var r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0!=r&&(t.x=e*t.x/r,t.y=e*t.y/r,t.z=e*t.z/r),t},pointLength3:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},getDistance:function(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)},getSlope:function(t,e){return(e.y-t.y)/(e.x-t.x)},getIntercept:function(t,e,r){var n=t.x+e.x,i=t.y+e.y;return i/2-r*n/2},getMidpoint:function(t,e){var r=[];return r.x=(t.x+e.x)/2,r.y=(t.y+e.y)/2,r},getMidperpendicular:function(t,e){var r=getSlope(t,e);x=checkEQ(r)?1:-1/r;var n=getMidpoint(t,e);return y=checkEQ(r)?0:n.y-x*n.x,{x:x,y:y}},getThroughPoint3:function(t,e,r){var n=getMidperpendicular(t,e),i=getMidperpendicular(t,r),o=[];o.x=(i.y-n.y)/(n.x-i.x),o.y=n.x*o.x+n.y;var a=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2));return{x:o.x,y:o.y,rad:a}},getHugeTriangle:function(t,e,r){var n=getThroughPoint3(t,e,r),i=n.x-Math.sqrt(3)*n.rad,o=n.y-n.rad,a=n.x+Math.sqrt(3)*n.rad,s=n.y-n.rad,c=n.x,u=n.y+2*n.rad;return[{x:i,y:o},{x:a,y:s},{x:c,y:u}]},checkEQ:function(t){var e=1e-6;return t>=-e&&e>=t}},ALGO.StringUtil={zeroPadding:function(t,e){return(Array(e).join("0")+t).slice(-e)},numComma:function(t){return String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},separate:function(t){return String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}},ALGO.ObjectUtil={extend:function(t,e){ALGO.ObjectUtil.clone(t);for(key in e){var r=e[key]?e[key]:t[key];t[key]=r}return t},clone:function(t){var e={};for(key in t)e[key]=t[key];return e}},ALGO.ColorUtil={rgbToHex:function(t,e,r){t=Math.floor(t),e=Math.floor(e),r=Math.floor(r);var n=(t<<16)+(e<<8)+r;return"0x"+n.toString(16)},hexToRgb:function(t){t=t.toString(16).replace("#","").replace("0x",""),t="0x"+t;var e={r:t>>16,g:t>>8&255,b:255&t};return e},hexToRgbNormalize:function(t){var e=ALGO.ColorUtil.hexToRgb(t);return e.r=e.r/256,e.g=e.g/256,e.b=e.b/256,e}},ALGO.Util={getBrowserLang:function(){var t=window.navigator.userAgent.toLowerCase();try{return-1!=t.indexOf("chrome")?(navigator.languages[0]||navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2):(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2)}catch(e){return void 0}},isSmartDevice:function(){var t=navigator.userAgent,e=!1;return t.indexOf("iPhone")>0&&-1==t.indexOf("iPad")||t.indexOf("iPod")>0||t.indexOf("Android")>0&&t.indexOf("Mobile")>0?e="smartphone":(t.indexOf("iPad")>0||t.indexOf("Android")>0)&&(e="tablet"),e},getOS:function(){var t,e=window.navigator.userAgent.toLowerCase();return t=e.match(/win/)?"win":e.match(/mac|ppc/)?"mac":e.match(/linux/)?"linux":"other"},getBrowser:function(){var t=window.navigator.userAgent.toLowerCase(),e=window.navigator.appVersion.toLowerCase(),r="unknown";return-1!=t.indexOf("msie")?r=-1!=e.indexOf("msie 6.")?"ie6":-1!=e.indexOf("msie 7.")?"ie7":-1!=e.indexOf("msie 8.")?"ie8":-1!=e.indexOf("msie 9.")?"ie9":-1!=e.indexOf("msie 10.")?"ie10":"ie":-1!=t.indexOf("trident/7")?r="ie11":-1!=t.indexOf("chrome")?r="chrome":-1!=t.indexOf("safari")?r="safari":-1!=t.indexOf("opera")?r="opera":-1!=t.indexOf("firefox")&&(r="firefox"),r},isSupported:function(t){for(var e=getBrowser(),r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},getQuery:function(){for(var t=window.location.search.substring(1),e=t.split("&"),r={},n=0;n<e.length;n++){var i=e[n].indexOf("=");if(i>0){var o=e[n].substring(0,i),a=e[n].substring(i+1);r[o]=a}}return r}};