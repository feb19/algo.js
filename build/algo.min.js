/*!*
 * algo.js
 *
 * JavaScript Creative Coding Framework
 * http://algojs.com
 *
 * Copyright 2015 hisa hayashi, HYS INC.
 */
var ALGO=function(){"use strict";function t(r){v=this,O=t.ObjectUtil.extend(param,r),e()}function e(){r(),i(),o()}function r(){v.width=param.width,v.height=param.height}function i(){v.render=new t.Render(v),v.render.setFramerate(v.framerate)}function n(){v.canvas=document.getElementById(O.id),v.canvas.width=O.width,v.canvas.height=O.height,v.renderer=new t.WebGLRenderer(v)}function o(){window.onload=function(){n(),v.setup&&v.setup.call(v)},window.onmouseover=function(){v.mouseover&&v.mouseover.call(v)},window.onmouseout=function(){v.mouseout&&v.mouseout.call(v)},window.onmousedown=function(){v.mousedown&&v.mousedown.call(v)},window.onmouseup=function(){v.mouseup&&v.mouseup.call(v)},window.onmousemove=function(t){if(v.mousemove){var e=t.clientX,r=t.clientY;v.mousemove.call(v,e,r)}},window.onkeydown=function(){v.keydown&&v.keydown.call(v)},window.onkeyup=function(){v.keyup&&v.keyup.call(v)},window.onresize=function(){v.resize&&v.resize.call(v),v.renderer&&v.renderer.resize()},v.render.startRender()}function a(t,e){this[t]=e,v[t]=this[t],v=this}function s(t,e){this[t]=e,v[t]=null}function h(){}function u(){}function c(){}function l(){}function p(){}function d(){}function f(){}function y(){}function x(){}function g(){}function _(){}function A(t,e){v.canvas.width=t,v.canvas.height=e,v.width=t,v.height=e}function m(t){t.add(v)}function L(t){t.remove(v)}var v,O={id:"",width:window.innerWidth,height:window.innerHeight};return t.prototype={constructor:t,setup:h,frame:u,destroy:c,mouseover:l,mouseout:p,mousedown:d,mouseup:f,mousemove:y,keydown:x,keyup:g,resize:_,bind:a,unbind:s,size:A,add:m,remove:L,render:null,renderer:null},t}();ALGO.debug=1,ALGO.BLEND_NONE=0,ALGO.BLEND_ADD=1,ALGO.BLEND_MULTIPLY=2,ALGO.BLEND_SCREEN=3,ALGO.prototype.__defineGetter__("framerate",function(){return this.framerate_}),ALGO.prototype.__defineSetter__("framerate",function(t){this.render&&this.render.setFramerate(t),this.framerate_=t}),ALGO.prototype.__defineGetter__("circleResolution",function(){return this.circleResolution_}),ALGO.prototype.__defineSetter__("circleResolution",function(t){ALGO.circleResolution=t,this.circleResolution_=t}),ALGO.prototype.width=0,ALGO.prototype.height=0,ALGO.prototype.blendMode=ALGO.BLEND_NONE,ALGO.prototype.backgroundAuto=!0,ALGO.prototype.background=6710886,ALGO.prototype.backgroundAlpha=.5,ALGO.prototype.framerate=60,ALGO.prototype.circleResolution=32,ALGO.prototype.canvas=null,ALGO.prototype.displayObjects=[],ALGO.prototype.children=[],ALGO.Render=function(){"use strict";function t(){e(),r()}function e(){}function r(){}function i(t){u=t,c=1e3/u,ALGO.log("setFramerate = "+u)}function n(){return u}function o(){y=!0,c=1e3/u,d=Date.now(),l=d,s()}function a(){y=!1}function s(){if(y&&g(s),p=Date.now(),f=p-d,f>c){d=p-f%c,h.renderer&&h.renderer.update(),h.frame&&h.frame.call(h);{var t=p-l;Math.round(1e3/(t/++x)*100)/100}}}var h,u,c,l,p,d,f,y=!1,x=0,g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/u)};return ALGO.Render=function(e){h=e,t()},ALGO.Render.prototype={constructor:ALGO.Render,setFramerate:i,getFramerate:n,startRender:o,stopRender:a},ALGO.Render}(),ALGO.Matrix3=function(t){"use strict";function e(){return new Float32Array(16)}function r(t){return t=[1,0,0,0,1,0,0,0,1]}function i(t,e,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],p=e[0],d=e[1],f=e[2],y=e[3],x=e[4],g=e[5],_=e[6],A=e[7],m=e[8];return r[0]=i*p+n*y+o*_,r[1]=i*d+n*x+o*A,r[2]=i*f+n*g+o*m,r[3]=a*p+s*y+h*_,r[4]=a*d+s*x+h*A,r[5]=a*f+s*g+h*m,r[6]=u*p+c*y+l*_,r[7]=u*d+c*x+l*A,r[8]=u*f+c*g+l*m,r}function n(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4]*e[1],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function o(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6]+e[0],r[7]=t[7]+e[1],r[8]=t[8],r}function a(t,e,r){var i=Math.cos(e),n=Math.sin(e);return r[0]=i,r[1]=-n,r[2]=t[2],r[3]=n,r[4]=i,r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function s(t,e){return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e}function h(t,e){return e}return t.Matrix3=function(){},t.Matrix3.prototype={constructor:t.Matrix3,create:e,identity:r,multiply:i,scale:n,translate:o,rotate:a,transpose:s,inverse:h},t.Matrix3}(ALGO),ALGO.Matrix4=function(t){"use strict";function e(){return new Float32Array(16)}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t,e,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],h=t[5],u=t[6],c=t[7],l=t[8],p=t[9],d=t[10],f=t[11],y=t[12],x=t[13],g=t[14],_=t[15],A=e[0],m=e[1],L=e[2],v=e[3],O=e[4],G=e[5],w=e[6],S=e[7],R=e[8],b=e[9],C=e[10],M=e[11],P=e[12],E=e[13],T=e[14],U=e[15];return r[0]=A*i+m*s+L*l+v*y,r[1]=A*n+m*h+L*p+v*x,r[2]=A*o+m*u+L*d+v*g,r[3]=A*a+m*c+L*f+v*_,r[4]=O*i+G*s+w*l+S*y,r[5]=O*n+G*h+w*p+S*x,r[6]=O*o+G*u+w*d+S*g,r[7]=O*a+G*c+w*f+S*_,r[8]=R*i+b*s+C*l+M*y,r[9]=R*n+b*h+C*p+M*x,r[10]=R*o+b*u+C*d+M*g,r[11]=R*a+b*c+C*f+M*_,r[12]=P*i+E*s+T*l+U*y,r[13]=P*n+E*h+T*p+U*x,r[14]=P*o+E*u+T*d+U*g,r[15]=P*a+E*c+T*f+U*_,r}function n(t,e,r){return r[0]=t[0]*e[0],r[1]=t[1]*e[0],r[2]=t[2]*e[0],r[3]=t[3]*e[0],r[4]=t[4]*e[1],r[5]=t[5]*e[1],r[6]=t[6]*e[1],r[7]=t[7]*e[1],r[8]=t[8]*e[2],r[9]=t[9]*e[2],r[10]=t[10]*e[2],r[11]=t[11]*e[2],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function o(t,e,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],r[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],r[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],r[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],r}function a(t,e,r,i){var n=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);if(!n)return null;var o=r[0],a=r[1],s=r[2];1!=n&&(n=1/n,o*=n,a*=n,s*=n);var h=Math.sin(e),u=Math.cos(e),c=1-u,l=t[0],p=t[1],d=t[2],f=t[3],y=t[4],x=t[5],g=t[6],_=t[7],A=t[8],m=t[9],L=t[10],v=t[11],O=o*o*c+u,G=a*o*c+s*h,w=s*o*c-a*h,S=o*a*c-s*h,R=a*a*c+u,b=s*a*c+o*h,C=o*s*c+a*h,M=a*s*c-o*h,P=s*s*c+u;return e?t!=i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=l*O+y*G+A*w,i[1]=p*O+x*G+m*w,i[2]=d*O+g*G+L*w,i[3]=f*O+_*G+v*w,i[4]=l*S+y*R+A*b,i[5]=p*S+x*R+m*b,i[6]=d*S+g*R+L*b,i[7]=f*S+_*R+v*b,i[8]=l*C+y*M+A*P,i[9]=p*C+x*M+m*P,i[10]=d*C+g*M+L*P,i[11]=f*C+_*M+v*P,i}function s(t,e,i,n){var o=t[0],a=t[1],s=t[2],h=i[0],u=i[1],c=i[2],l=e[0],p=e[1],d=e[2];if(o==l&&a==p&&s==d)return r(n);var f,y,x,g,_,A,m,L,v,O;return m=o-e[0],L=a-e[1],v=s-e[2],O=1/Math.sqrt(m*m+L*L+v*v),m*=O,L*=O,v*=O,f=u*v-c*L,y=c*m-h*v,x=h*L-u*m,O=Math.sqrt(f*f+y*y+x*x),O?(O=1/O,f*=O,y*=O,x*=O):(f=0,y=0,x=0),g=L*x-v*y,_=v*f-m*x,A=m*y-L*f,O=Math.sqrt(g*g+_*_+A*A),O?(O=1/O,g*=O,_*=O,A*=O):(g=0,_=0,A=0),n[0]=f,n[1]=g,n[2]=m,n[3]=0,n[4]=y,n[5]=_,n[6]=L,n[7]=0,n[8]=x,n[9]=A,n[10]=v,n[11]=0,n[12]=-(f*o+y*a+x*s),n[13]=-(g*o+_*a+A*s),n[14]=-(m*o+L*a+v*s),n[15]=1,n}function h(t,e,r,i,n){var o=r*Math.tan(t*Math.PI/360),a=o*e,s=2*a,h=2*o,u=i-r;return n[0]=2*r/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*r/h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-(i+r)/u,n[11]=-1,n[12]=0,n[13]=0,n[14]=-(i*r*2)/u,n[15]=0,n}function u(t,e){return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e}function c(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],h=t[6],u=t[7],c=t[8],l=t[9],p=t[10],d=t[11],f=t[12],y=t[13],x=t[14],g=t[15],_=r*s-i*a,A=r*h-n*a,m=r*u-o*a,L=i*h-n*s,v=i*u-o*s,O=n*u-o*h,G=c*y-l*f,w=c*x-p*f,S=c*g-d*f,R=l*x-p*y,b=l*g-d*y,C=p*g-d*x,M=1/(_*C-A*b+m*R+L*S-v*w+O*G);return e[0]=(s*C-h*b+u*R)*M,e[1]=(-i*C+n*b-o*R)*M,e[2]=(y*O-x*v+g*L)*M,e[3]=(-l*O+p*v-d*L)*M,e[4]=(-a*C+h*S-u*w)*M,e[5]=(r*C-n*S+o*w)*M,e[6]=(-f*O+x*m-g*A)*M,e[7]=(c*O-p*m+d*A)*M,e[8]=(a*b-s*S+u*G)*M,e[9]=(-r*b+i*S-o*G)*M,e[10]=(f*v-y*m+g*_)*M,e[11]=(-c*v+l*m-d*_)*M,e[12]=(-a*R+s*w-h*G)*M,e[13]=(r*R-i*w+n*G)*M,e[14]=(-f*L+y*A-x*_)*M,e[15]=(c*L-l*A+p*_)*M,e}return t.Matrix4=function(){},t.Matrix4.prototype={constructor:t.Matrix4,create:e,identity:r,multiply:i,scale:n,translate:o,rotate:a,lookAt:s,perspective:h,transpose:u,inverse:c},t.Matrix4}(ALGO),ALGO.ShapeCtrl={createID:function(t,e){for(var r="abcdefghijklmnopqrstuvwxyz0123456789",i=e?e:12,n="",o=0;i>o;o++){var a=r.length,s=Math.floor(Math.random()*a);n+=r.charAt(s)}return t.indexOf(n)>-1&&arguments.callee(t,e),n}},ALGO.Shape=function(){"use strict";function t(){"path"!==this.type&&(this.geometry=[],this.vertexPosition=[],this.vertexColors=[],this.vertexLineColors=[],this.index=[]),this.m=new ALGO.Matrix3,this.matrix=this.m.identity(this.m.create()),this.matrixScale=this.m.identity(this.m.create()),this.matrixRotate=this.m.identity(this.m.create()),this.matrixTranslate=this.m.identity(this.m.create())}function e(){this.setGeometry(),this.setVertexPosition(),this.setVertexColor(this.color,this.vertexColors),this.setVertexAlpha(this.alpha,this.vertexColors),this.setVertexColor(this.lineColor,this.vertexLineColors),this.setVertexAlpha(this.lineAlpha,this.vertexLineColors),this.setIndex(),this.setScale(this.scale),this.setRotate(this.rotate),this.setTranslate(this.x,this.y)}function r(t){this.id||(this.id=ALGO.ShapeCtrl.createID(t.displayObjects,8)),t.displayObjects.push(this.id),t.children.push(this)}function i(t){var e=t.displayObjects.indexOf(id);e>-1&&(t.displayObjects.splice(e,1),t.children.splice(e,1))}function n(){this.geometry=[],this.vertexPosition=[],this.vertexColors=[],this.vertexLineColors=[],this.setVertexPosition(),this.setVertexColor(this.color,this.vertexColors),this.setVertexAlpha(this.alpha,this.vertexColors),this.setVertexColor(this.lineColor,this.vertexLineColors),this.setVertexAlpha(this.lineAlpha,this.vertexLineColors)}function o(){}function a(){var t=this.geometry;t[0]={x:0,y:-1},t[1]={x:-.87,y:.5},t[2]={x:.87,y:.5}}function s(){for(var t=this.vertexPosition,e=this.geometry.length,r=0;e>r;r++){var i=2*r;t[i]=this.geometry[r].x,t[i+1]=this.geometry[r].y}}function h(t,e){for(var r=e,i=this.geometry.length,n=ALGO.ColorUtil.hexToRgbNormalize(t),o=0;i>o;o++){var a=4*o;r[a]=n.r,r[a+1]=n.g,r[a+2]=n.b}}function u(t,e){for(var r=e,i=this.geometry.length,n=0;i>n;n++){var o=4*n;r[o+3]=t}}function c(){var t=[0,1,2];this.index=t}function l(t){if(this.m){var e=this.radius*t,r=this.radius*t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}}function p(t){if(this.m){var e=t*Math.PI/180;this.m.rotate(this.matrix,e,this.matrixRotate)}}function d(t,e){this.m&&this.m.translate(this.matrix,[t,e,0],this.matrixTranslate)}function f(){var t=null;return this.m&&(t=this.m.identity(this.m.create()),this.m.multiply(t,this.matrixScale,t),this.m.multiply(t,this.matrixRotate,t),this.m.multiply(t,this.matrixTranslate,t)),t}return ALGO.Shape=function(t,e,r){this.x=t,this.y=e,this.angles=3,this.radius=r,this.angles_=3,this.radius_=r,this.init(),this.setup()},ALGO.Shape.prototype={constructor:ALGO.Shape,name:"",type:"shape",id:null,x:0,y:0,angles:void 0,radius:null,alpha:1,visible:!0,color:16777215,scale:1,rotate:0,line:!1,lineColor:0,lineAlpha:1,lineWidth:1,fill:!0,m:void 0,matrix:void 0,matrixScale:void 0,matrixRotate:void 0,matrixTranslate:void 0,parent:void 0,children:[],geometry:[],vertexPosition:[],vertexColors:[],vertexLineColors:[],needsUpdate:!1,geometry:[],index:[],x_:0,y_:0,scale_:1,rotate_:0,radius_:null,color_:16777215,alpha_:1,angle_:void 0,needsUpdate_:!1,lineColor_:0,lineAlpha_:1,init:t,setup:e,add:r,remove:i,clone:o,clear:n,setGeometry:a,setVertexPosition:s,setVertexColor:h,setVertexAlpha:u,setIndex:c,setScale:l,setRotate:p,setTranslate:d,getMatrix:f},ALGO.Shape}(),ALGO.Shape.prototype.__defineGetter__("x",function(){return this.x_}),ALGO.Shape.prototype.__defineSetter__("x",function(t){this.x_=t,this.setTranslate(this.x,this.y)}),ALGO.Shape.prototype.__defineGetter__("y",function(){return this.y_}),ALGO.Shape.prototype.__defineSetter__("y",function(t){this.y_=t,this.setTranslate(this.x,this.y)}),ALGO.Shape.prototype.__defineGetter__("scale",function(){return this.scale_}),ALGO.Shape.prototype.__defineSetter__("scale",function(t){this.setScale(t),this.scale_=t}),ALGO.Shape.prototype.__defineGetter__("rotate",function(){return this.rotate_}),ALGO.Shape.prototype.__defineSetter__("rotate",function(t){this.setRotate(t),this.rotate_=t}),ALGO.Shape.prototype.__defineGetter__("radius",function(){return this.radius_}),ALGO.Shape.prototype.__defineSetter__("radius",function(t){this.setScale(this.scale),this.radius_=t}),ALGO.Shape.prototype.__defineGetter__("color",function(){return this.color_}),ALGO.Shape.prototype.__defineSetter__("color",function(t){this.setVertexColor(t,this.vertexColors),this.color_=t}),ALGO.Shape.prototype.__defineGetter__("alpha",function(){return this.alpha_}),ALGO.Shape.prototype.__defineSetter__("alpha",function(t){this.setVertexAlpha(t,this.vertexColors),this.alpha_=t}),ALGO.Shape.prototype.__defineGetter__("lineColor",function(){return this.lineColor_}),ALGO.Shape.prototype.__defineSetter__("lineColor",function(t){this.setVertexColor(t,this.vertexLineColors),this.lineColor_=t}),ALGO.Shape.prototype.__defineGetter__("lineAlpha",function(){return this.lineAlpha_}),ALGO.Shape.prototype.__defineSetter__("lineAlpha",function(t){this.setVertexAlpha(t,this.vertexLineColors),this.lineAlpha_=t}),ALGO.Shape.prototype.__defineGetter__("angle",function(){return this.angle_}),ALGO.Shape.prototype.__defineSetter__("angle",function(t){this.angle_=t}),ALGO.Shape.prototype.__defineGetter__("needsUpdate",function(){return this.needsUpdate_}),ALGO.Shape.prototype.__defineSetter__("needsUpdate",function(t){this.needsUpdate_=t}),ALGO.Polygon=function(t,e,r,i){"use strict";this.x=t,this.y=e,this.angles=r,this.radius=i,this.angles_=r,this.radius_=i,this.type="polygon",this.init(),this.setup()},ALGO.Polygon.prototype=Object.create(ALGO.Shape.prototype),ALGO.Polygon.prototype.constructor=ALGO.Polygon,ALGO.Polygon.prototype.setGeometry=function(){for(var t=this.geometry=[],e=0;e<this.angles;e++)t[e]={},t[e].x=Math.cos(2*e*Math.PI/this.angles-Math.PI/2),t[e].y=Math.sin(2*e*Math.PI/this.angles-Math.PI/2)},ALGO.Polygon.prototype.setIndex=function(){var t=this.index=[];for(i=1;i<this.angles-1;i++)t.push(0),t.push(i),t.push(i+1)},ALGO.Circle=function(t,e,r){"use strict";this.x=t,this.y=e,this.angles=ALGO.circleResolution,this.radius=r,this.angles_=ALGO.circleResolution,this.radius_=r,this.type="circle",this.init(),this.setup()},ALGO.Circle.prototype=Object.create(ALGO.Polygon.prototype),ALGO.Circle.prototype.constructor=ALGO.Circle,ALGO.Rectangle=function(t,e,r,i){"use strict";this.x=t,this.y=e,this.width=r,this.height=i,this.width_=r,this.height_=i,this.type="rectangle",this.init(),this.setup()},ALGO.Rectangle.prototype=Object.create(ALGO.Shape.prototype),ALGO.Rectangle.prototype.constructor=ALGO.Rectangle,ALGO.Rectangle.prototype.width=0,ALGO.Rectangle.prototype.height=0,ALGO.Rectangle.prototype.width_=0,ALGO.Rectangle.prototype.height_=0,ALGO.Rectangle.prototype.setGeometry=function(){var t=this.geometry=[];t[0]=[],t[0].x=-.5,t[0].y=-.5,t[1]=[],t[1].x=.5,t[1].y=-.5,t[2]=[],t[2].x=.5,t[2].y=.5,t[3]=[],t[3].x=-.5,t[3].y=.5},ALGO.Rectangle.prototype.setScale=function(t){if(this.m){var e=this.width*t,r=this.height*t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}},ALGO.Rectangle.prototype.setIndex=function(){var t=[0,1,2,0,2,3];this.index=t},ALGO.Rectangle.prototype.__defineGetter__("width",function(){return this.width_}),ALGO.Rectangle.prototype.__defineSetter__("width",function(t){this.width_=t,this.setScale(this.scale)}),ALGO.Rectangle.prototype.__defineGetter__("height",function(){return this.height_}),ALGO.Rectangle.prototype.__defineSetter__("height",function(t){this.height_=t,this.setScale(this.scale)}),ALGO.Path=function(t,e){"use strict";this.moveTo(t.x,t.y),this.lineTo(e.x,e.y),ALGO.log(this.geometry),this.type="path",this.init(),this.setup()},ALGO.Path.prototype=Object.create(ALGO.Shape.prototype),ALGO.Path.prototype.constructor=ALGO.Path,ALGO.Path.prototype.closed=!1,ALGO.Path.prototype.setGeometry=function(){},ALGO.Path.prototype.setScale=function(t){if(this.m){var e=t,r=t;this.m.scale(this.matrix,[e,r,0],this.matrixScale)}},ALGO.Path.prototype.moveTo=function(t,e){var r={x:t,y:e};this.geometry.push(r),this.vertexUpdate()},ALGO.Path.prototype.lineTo=function(t,e){var r={x:t,y:e};this.geometry.push(r),this.vertexUpdate()},ALGO.Path.prototype.vertexUpdate=function(){this.setVertexPosition(),this.setVertexColor(this.color,this.vertexColors),this.setVertexAlpha(this.alpha,this.vertexColors),this.setVertexColor(this.lineColor,this.vertexLineColors),this.setVertexAlpha(this.lineAlpha,this.vertexLineColors)},ALGO.Path.prototype.close=function(){this.closed=!0},ALGO.WebGLRenderer=function(t){"use strict";function e(t,e){return[2/t,0,0,0,-2/e,0,-1,1,1]}function r(){for(var r=new t.Matrix3,i=e(m,L),n=0;n<b.length;n++){var o=b[n],a=o.needsUpdate,s=o.fill,h=o.line,u=o.vertexPosition,c=o.vertexColors,l=o.vertexLineColors||o.vertexColors,y=o.index,g=o.getMatrix(),O=r.multiply(g,i,[]),G=o.lineWidth;if(s){if(!M[n]||a){var w=[];w.position=p(u),w.color=p(c),M[n]=w}if(f(M[n],_,A),"path"!==o.type&&"particle"!==o.type){if(!E[n]||a){var S=d(y);T[n]=y,E[n]=S}x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,E[n])}x.uniformMatrix3fv(v.matrix,!1,O),"path"==o.type?o.closed?x.drawArrays(x.TRIANGLES,0,u.length/2):x.drawArrays(x.TRIANGLES,0,u.length/2):"particle"==o.type?x.drawArrays(x.POINTS,0,u.length/2):x.drawElements(x.TRIANGLES,T[n].length,x.UNSIGNED_SHORT,0)}if(h){if(!P[n]||a){var w=[];w.position=p(u),w.color=p(l),P[n]=w}f(P[n],_,A),x.uniformMatrix3fv(v.matrix,!1,O),x.lineWidth(G),"path"==o.type?o.closed?x.drawArrays(x.LINE_LOOP,0,u.length/2):x.drawArrays(x.LINE_STRIP,0,u.length/2):x.drawArrays(x.LINE_LOOP,0,u.length/2)}a&&(o.needsUpdate=!1)}x.flush()}function i(){m=O.width,L=O.height;var t=x.getUniformLocation(g,"u_resolution");x.uniform2f(t,O.width,O.height),x.viewport(0,0,m,L)}function n(){o(y),a(),S&&(s(),h()),u()}function o(t){O=t.canvas,G=t.background,w=t.backgroundAlpha,S=t.backgroundAuto,R=t.depth,b=t.children,C=t.displayObjects}function a(){x.clearDepth(R)}function s(){var e=t.ColorUtil.hexToRgbNormalize(G);x.clearColor(e.r,e.g,e.b,w)}function h(){x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT)}function u(){r()}function c(t){var e,r="";return"vertex"==t?(r="\r\n      attribute vec2 position2d;\r\n      uniform mat3 matrix2d;\r\n      uniform vec2 u_resolution;\r\n      attribute vec4 color;\r\n      varying   vec4 v_color; \r\n      uniform float point_size;\r\n      \r\n      void main(void){\r\n        v_color = color;\r\n        gl_PointSize = point_size;\r\n        \r\n        gl_Position = vec4((matrix2d * vec3(position2d, 1)).xy, 0, 1);\r\n      }",e=x.createShader(x.VERTEX_SHADER)):"fragment"==t&&(r="\r\n      precision mediump float;\r\n      varying vec4 v_color;\r\n      \r\n      void main(void){\r\n        gl_FragColor = v_color;\r\n      }",e=x.createShader(x.FRAGMENT_SHADER)),x.shaderSource(e,r),x.compileShader(e),x.getShaderParameter(e,x.COMPILE_STATUS)?e:void alert(x.getShaderInfoLog(e))}function l(t,e){var r=x.createProgram();return x.attachShader(r,t),x.attachShader(r,e),x.linkProgram(r),x.getProgramParameter(r,x.LINK_STATUS)?(x.useProgram(r),r):void alert(x.getProgramInfoLog(r))}function p(t){var e=x.createBuffer();return x.bindBuffer(x.ARRAY_BUFFER,e),x.bufferData(x.ARRAY_BUFFER,new Float32Array(t),x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),e}function d(t){var e=x.createBuffer();return x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,e),x.bufferData(x.ELEMENT_ARRAY_BUFFER,new Int16Array(t),x.STATIC_DRAW),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null),e}function f(t,e,r){for(var i in t)x.bindBuffer(x.ARRAY_BUFFER,t[i]),x.enableVertexAttribArray(e[i]),x.vertexAttribPointer(e[i],r[i],x.FLOAT,!1,0,0)}var y,x,g,_,A,m,L,v,O,G,w,S,R,b,C,M=[],P=[],E=[],T=[];return t.WebGLRenderer=function(t){y=t,o(y),x=O.getContext("webgl")||O.getContext("experimental-webgl");var e=c("vertex"),n=c("fragment");g=l(e,n),i(),v={},v.position=x.getUniformLocation(g,"position2d"),v.matrix=x.getUniformLocation(g,"matrix2d"),v.color=x.getUniformLocation(g,"color"),v.point_size=x.getUniformLocation(g,"point_size"),_={},_.position=x.getAttribLocation(g,"position2d"),_.color=x.getAttribLocation(g,"color"),A={},A.position=2,A.color=4,r()},t.WebGLRenderer.prototype={constructor:t.WebGLRenderer,update:n,resize:i},t.WebGLRenderer}(ALGO),ALGO.log=function(t){window.console&&window.console.log&&ALGO.debug&&window.console.log(t)},ALGO.warn=function(t){window.console&&window.console.warn&&ALGO.debug&&window.console.warn(t)},ALGO.error=function(t){window.console&&window.console.error&&ALGO.debug&&window.console.error(t)},ALGO.PointUtil={normalize:function(t,e){var r=Math.sqrt(t.x*t.x+t.y*t.y);0!=r&&(t.x=e*t.x/r,t.y=e*t.y/r)},normalize3:function(t,e){var r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0!=r&&(t.x=e*t.x/r,t.y=e*t.y/r,t.z=e*t.z/r),t},pointLength3:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},getDistance:function(t,e){var r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)},getSlope:function(t,e){return(e.y-t.y)/(e.x-t.x)},getIntercept:function(t,e,r){var i=t.x+e.x,n=t.y+e.y;return n/2-r*i/2},getMidpoint:function(t,e){var r=[];return r.x=(t.x+e.x)/2,r.y=(t.y+e.y)/2,r},getMidperpendicular:function(t,e){var r=getSlope(t,e);x=checkEQ(r)?1:-1/r;var i=getMidpoint(t,e);return y=checkEQ(r)?0:i.y-x*i.x,{x:x,y:y}},getThroughPoint3:function(t,e,r){var i=getMidperpendicular(t,e),n=getMidperpendicular(t,r),o=[];o.x=(n.y-i.y)/(i.x-n.x),o.y=i.x*o.x+i.y;var a=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2));return{x:o.x,y:o.y,rad:a}},getHugeTriangle:function(t,e,r){var i=getThroughPoint3(t,e,r),n=i.x-Math.sqrt(3)*i.rad,o=i.y-i.rad,a=i.x+Math.sqrt(3)*i.rad,s=i.y-i.rad,h=i.x,u=i.y+2*i.rad;return[{x:n,y:o},{x:a,y:s},{x:h,y:u}]},checkEQ:function(t){var e=1e-6;return t>=-e&&e>=t}},ALGO.StringUtil={zeroPadding:function(t,e){return(Array(e).join("0")+t).slice(-e)},numComma:function(t){return String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},separate:function(t){return String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}},ALGO.ObjectUtil={extend:function(t,e){ALGO.ObjectUtil.clone(t);for(key in e){var r=e[key]?e[key]:t[key];t[key]=r}return t},clone:function(t){var e={};for(key in t)e[key]=t[key];return e}},ALGO.ColorUtil={rgbToHex:function(t,e,r){t=Math.floor(t),e=Math.floor(e),r=Math.floor(r);var i=(t<<16)+(e<<8)+r;return"0x"+i.toString(16)},hexToRgb:function(t){t=t.toString(16).replace("#","").replace("0x",""),t="0x"+t;var e={r:t>>16,g:t>>8&255,b:255&t};return e},hexToRgbNormalize:function(t){var e=ALGO.ColorUtil.hexToRgb(t);return e.r=e.r/256,e.g=e.g/256,e.b=e.b/256,e}},ALGO.Util={getBrowserLang:function(){var t=window.navigator.userAgent.toLowerCase();try{return-1!=t.indexOf("chrome")?(navigator.languages[0]||navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2):(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2)}catch(e){return void 0}},isSmartDevice:function(){var t=navigator.userAgent,e=!1;return t.indexOf("iPhone")>0&&-1==t.indexOf("iPad")||t.indexOf("iPod")>0||t.indexOf("Android")>0&&t.indexOf("Mobile")>0?e="smartphone":(t.indexOf("iPad")>0||t.indexOf("Android")>0)&&(e="tablet"),e},getOS:function(){var t,e=window.navigator.userAgent.toLowerCase();return t=e.match(/win/)?"win":e.match(/mac|ppc/)?"mac":e.match(/linux/)?"linux":"other"},getBrowser:function(){var t=window.navigator.userAgent.toLowerCase(),e=window.navigator.appVersion.toLowerCase(),r="unknown";return-1!=t.indexOf("msie")?r=-1!=e.indexOf("msie 6.")?"ie6":-1!=e.indexOf("msie 7.")?"ie7":-1!=e.indexOf("msie 8.")?"ie8":-1!=e.indexOf("msie 9.")?"ie9":-1!=e.indexOf("msie 10.")?"ie10":"ie":-1!=t.indexOf("trident/7")?r="ie11":-1!=t.indexOf("chrome")?r="chrome":-1!=t.indexOf("safari")?r="safari":-1!=t.indexOf("opera")?r="opera":-1!=t.indexOf("firefox")&&(r="firefox"),r},isSupported:function(t){for(var e=getBrowser(),r=0;r<t.length;r++)if(t[r]==e)return!0;return!1},getQuery:function(){for(var t=window.location.search.substring(1),e=t.split("&"),r={},i=0;i<e.length;i++){var n=e[i].indexOf("=");if(n>0){var o=e[i].substring(0,n),a=e[i].substring(n+1);r[o]=a}}return r}};